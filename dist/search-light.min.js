'use strict';function SearchLight(){}SearchLight.prototype={search(a){var b=Object.create(SearchLight.prototype,{state_:{value:{matches:[],partial:[],allItems:[],searchText:'',searchTerms:[],keys:[],filters:[],threshold:0,error:!1,errorMessage:'',index:0,lastIndex:0,totalMatches:0,ready:!1,complete:!1,searched:!1}},settings_:{value:{collectionType:'array',case:!1,baseThreshold:0,sort:!1,customSort:null,inject:{property:'searchResults',enabled:!1}}}});return b.functions_.collection_.call(b,a)},for(a){return this.state_.searchText='',this.state_.filters=[],this.and(a)},and(a){if(this.state_.ready=!1,this.state_.complete=!1,this.state_.searched=!1,'string'==typeof a)this.state_.searchText=(this.state_.searchText+' '+a).trim();else if('object'==typeof a){var b,c,d;Array.isArray(a)?(b=a[0],c=a[1],d=a[2]):(b=a.key,c=a.operator,d=a.value),'undefined'==typeof d&&(d=c,c='=='),this.state_.filters.push([b,c,d])}else console.warn('Invalid constraint type: ',typeof a);return this},in(a){return this.state_.keys=[],this.or(a)},or(a){return this.state_.ready=!1,this.state_.complete=!1,this.state_.searched=!1,'string'==typeof a?this.state_.keys.push(a):Array.prototype.push.apply(this.state_.keys,a),this},sorted(){return this.settings_.sort||(this.settings_.sort=!0,this.state_.complete=!1),this},unsorted(){return this.settings_.sort&&(this.settings_.sort=!1,this.state_.complete=!1),this},sortUsing(a){return this.settings_.customSort=a,this.state_.complete=!1,this},compareCase(){return this.settings_.case||(this.settings_.case=!0,this.state_.complete=!1,this.state_.searched=!1),this},ignoreCase(){return this.settings_.case&&(this.settings_.case=!1,this.state_.complete=!1,this.state_.searched=!1),this},withStats(a){return this.settings_.inject.enabled=!0,'undefined'!=typeof a&&(this.settings_.inject.property=a),this},withoutStats(){return this.settings_.inject.enabled=!1,this},then(a,b){var c=new Promise(function(a,b){if(this.functions_.updateMatches_.call(this),this.state_.error)b(Error(this.state_.errorMessage));else{var c=this;a({get matches(){return c.matches},get partialMatchess(){return c.partialMatches},get allMatchess(){return c.allMatches}})}}.bind(this));return c.then(a,b),this},catch(a){return this.then(void 0,a)},get length(){return this.functions_.updateMatches_.call(this),this.state_.totalMatches},get matches(){this.functions_.updateMatches_.call(this);var a=this.functions_.toOriginalFormat_.call(this,this.state_.matches);return a},get partialMatches(){return this.functions_.updateMatches_.call(this),this.functions_.performSort_.call(this,this.state_.partial),this.functions_.toOriginalFormat_.call(this,this.state_.partial)},get allMatches(){this.functions_.updateMatches_.call(this);var a=this.state_.matches.concat(this.state_.partial);return this.functions_.performSort_.call(this,a),this.functions_.toOriginalFormat_.call(this,a)},get allItems(){return this.functions_.updateMatches_.call(this),this.functions_.performSort_.call(this,this.state_.allItems),this.functions_.toOriginalFormat_.call(this,this.state_.allItems)},[Symbol.iterator](){return this.updateMatches_(),this.settings_.inject.enabled?{next:this.iterators_.nextInject_.bind(this)}:{next:this.iterators_.next_.bind(this)}},functions_:{collection_(a){var b=[];return Array.isArray(a)?b=Array.from(a.keys()):'object'==typeof a?(b=Object.keys(a).filter((b)=>a.hasOwnProperty(b)),this.settings_.collectionType='object'):(this.state_.error=!0,this.state_.errorMessage='Invalid collection type: '+typeof a,console.warn(this.state_.errorMessage)),this.state_.collection=new Map(b.map(this.iterators_.collection_.bind(this,a))),this.state_.complete=!1,this.state_.searched=!1,this},performSearch_(){this.functions_.isConstrained.call(this)?(this.state_.allItems=[],this.state_.matches=[],this.state_.partial=[],this.state_.collection.forEach(this.iterators_.calculateRelevance_.bind(this))):(this.state_.allItems=Array.from(this.state_.collection.keys()).map(this.iterators_.emptyMatch_),this.state_.matches=this.state_.allItems,this.state_.partial=[]),this.state_.searched=!0},updateMatches_(){this.state_.complete||(!this.state_.searched&&this.functions_.performSearch_.call(this),this.functions_.performSort_.call(this,this.state_.matches),this.state_.totalMatches=this.state_.matches.length,this.state_.index=0,this.state_.lastIndex=this.state_.totalMatches-1,this.state_.complete=!0)},performSort_(a){this.settings_.sort&&this.functions_.isConstrained.call(this)&&a.length&&a.sort(this.iterators_.sortComparator_),null!==this.settings_.customSort&&a.sort(this.settings_.customSort.bind(null,this.functions_.getItem_.bind(this)))},getItem_(a){return this.state_.collection.get(a[0])},getItemInject_(a){var b=this.state_.collection.get(a[0]);return Array.isArray(b)?b.push({relevance:a[1],missing:a[2]}):'object'==typeof b&&(b[this.settings_.inject.property]={relevance:a[1],missing:a[2]}),b},toOriginalFormat_(a){return'array'===this.settings_.collectionType?this.settings_.inject.enabled?a.map(this.functions_.getItemInject_,this):a.map(this.functions_.getItem_,this):this.settings_.inject.enabled?a.reduce(this.iterators_.reduceInject_.bind(this),{}):a.reduce(this.iterators_.reduce_.bind(this),{})},updateConstraints_(){this.state_.ready||(this.state_.searchTerms=''===this.state_.searchText?[]:(this.settings_.case?this.state_.searchText:this.state_.searchText.toLowerCase()).split(' '),this.state_.threshold=this.settings_.baseThreshold+this.state_.filters.length+(0<this.state_.searchTerms.length),this.state_.ready=!0)},isConstrained(){return this.functions_.updateConstraints_.call(this),this.state_.searchTerms.length||this.state_.filters.length}},iterators_:{collection_(a,b){return[b,a[b]]},next_(){return this.state_.index>this.state_.lastIndex?{done:!0}:{done:!1,value:this.functions_.getItem_(this.state_.matches[this.state_.index++])}},nextInject_(){return this.state_.index>this.state_.lastIndex?{done:!0}:{done:!1,value:this.functions_.getItemInject_(this.state_.matches[this.state_.index++])}},property_(a,b){return a[b]||null},search_(a,b,c){var d=b.split(c).length-1;d?a[1]+=d:a[2]+=' '+c},filter_(a,b,c){var d=c[0],e=c[1],f=c[2];'string'!=typeof a&&('=='===e?b[1]+=a[d]==f:'==='===e?b[1]+=a[d]===f:'!='===e?b[1]+=a[d]!=f:'!=='===e?b[1]+=a[d]!==f:'>'===e?b[1]+=a[d]>f:'>='===e?b[1]+=a[d]>=f:'<'===e?b[1]+=a[d]<f:'<='===e?b[1]+=a[d]<=f:console.warn('Invalid filter operator:',e))},calculateRelevance_(a,b){var c=[b,0,''],d='';this.state_.filters.forEach(this.iterators_.filter_.bind(this,a,c)),d='string'==typeof a?a:this.state_.keys.length?this.state_.keys.map(this.iterators_.property_.bind(this,a)).join('|'):Array.isArray(a)?a.join('|'):Object.keys(a).reduce(this.iterators_.reduceProperties_.bind(this,a),''),this.settings_.case||(d=d.toLowerCase()),this.state_.searchTerms.forEach(this.iterators_.search_.bind(this,c,d)),this.state_.allItems.push(c),0===c[1]||(c[1]<this.state_.threshold?this.state_.partial.push(c):this.state_.matches.push(c))},emptyMatch_(a){return[a,0,'']},reduce_(a,b){return a[b[0]]=this.functions_.getItem_.call(this,b),a},reduceInject_(a,b){return a[b[0]]=this.functions_.getItemInject_.call(this,b),a},reduceProperties_(a,b,c){return b+='|'+a[c],b},sortComparator_(a,b){return b[1]>a[1]?1:b[1]===a[1]?b[0]<a[0]:-1}}},'undefined'==typeof window?(Object.defineProperty(exports,'__esModule',{value:!0}),exports.default=SearchLight.prototype.search):window.searchLight={search:SearchLight.prototype.search};