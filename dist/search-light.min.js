"use strict";function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function SearchLight(){}var _SearchLight$prototyp,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};Object.defineProperty(exports,"__esModule",{value:!0}),SearchLight.prototype=(_SearchLight$prototyp={search:function(t){var e=Object.create(SearchLight.prototype,{state_:{value:{matches:[],partial:[],allItems:[],searchText:"",searchTerms:[],keys:[],filters:[],threshold:0,error:!1,errorMessage:"",index:0,lastIndex:0,totalMatches:0,ready:!1,complete:!1,searched:!1}},settings_:{value:{collectionType:"array",case:!1,baseThreshold:0,sort:!1,customSort:null,inject:{property:"searchResults",enabled:!1}}}});return e.functions_.collection_.call(e,t)},for:function(t){return this.state_.searchText="",this.state_.filters=[],this.and(t)},and:function(t){if(this.state_.ready=!1,this.state_.complete=!1,this.state_.searched=!1,"string"==typeof t)this.state_.searchText=(this.state_.searchText+" "+t).trim();else if("object"===(void 0===t?"undefined":_typeof(t))){var e,s,i;Array.isArray(t)?(e=t[0],s=t[1],i=t[2]):(e=t.key,s=t.operator,i=t.value),void 0===i&&(i=s,s="=="),this.state_.filters.push([e,s,i])}else console.warn("Invalid constraint type: ",void 0===t?"undefined":_typeof(t));return this},in:function(t){return this.state_.keys=[],this.or(t)},or:function(t){return this.state_.ready=!1,this.state_.complete=!1,this.state_.searched=!1,"string"==typeof t?this.state_.keys.push(t):Array.prototype.push.apply(this.state_.keys,t),this},sorted:function(){return this.settings_.sort||(this.settings_.sort=!0,this.state_.complete=!1),this},unsorted:function(){return this.settings_.sort&&(this.settings_.sort=!1,this.state_.complete=!1),this},sortUsing:function(t){return this.settings_.customSort=t,this.state_.complete=!1,this},compareCase:function(){return this.settings_.case||(this.settings_.case=!0,this.state_.complete=!1,this.state_.searched=!1),this},ignoreCase:function(){return this.settings_.case&&(this.settings_.case=!1,this.state_.complete=!1,this.state_.searched=!1),this},withStats:function(t){return this.settings_.inject.enabled=!0,void 0!==t&&(this.settings_.inject.property=t),this},withoutStats:function(){return this.settings_.inject.enabled=!1,this},then:function(t,e){return new Promise(function(t,e){if(this.functions_.updateMatches_.call(this),this.state_.error)e(Error(this.state_.errorMessage));else{var s=this;t({get matches(){return s.matches},get partialMatchess(){return s.partialMatches},get allMatchess(){return s.allMatches}})}}.bind(this)).then(t,e),this},catch:function(t){return this.then(void 0,t)},get length(){return this.functions_.updateMatches_.call(this),this.state_.totalMatches},get matches(){return this.functions_.updateMatches_.call(this),this.functions_.toOriginalFormat_.call(this,this.state_.matches)},get partialMatches(){return this.functions_.updateMatches_.call(this),this.functions_.performSort_.call(this,this.state_.partial),this.functions_.toOriginalFormat_.call(this,this.state_.partial)},get allMatches(){this.functions_.updateMatches_.call(this);var t=this.state_.matches.concat(this.state_.partial);return this.functions_.performSort_.call(this,t),this.functions_.toOriginalFormat_.call(this,t)},get allItems(){return this.functions_.updateMatches_.call(this),this.functions_.performSort_.call(this,this.state_.allItems),this.functions_.toOriginalFormat_.call(this,this.state_.allItems)}},_defineProperty(_SearchLight$prototyp,Symbol.iterator,function(){return this.updateMatches_(),this.settings_.inject.enabled?{next:this.iterators_.nextInject_.bind(this)}:{next:this.iterators_.next_.bind(this)}}),_defineProperty(_SearchLight$prototyp,"functions_",{collection_:function(t){var e=[];return Array.isArray(t)?e=Array.from(t.keys()):"object"===(void 0===t?"undefined":_typeof(t))?(e=Object.keys(t).filter(function(e){return t.hasOwnProperty(e)}),this.settings_.collectionType="object"):(this.state_.error=!0,this.state_.errorMessage="Invalid collection type: "+(void 0===t?"undefined":_typeof(t)),console.warn(this.state_.errorMessage)),this.state_.collection=new Map(e.map(this.iterators_.collection_.bind(this,t))),this.state_.complete=!1,this.state_.searched=!1,this},performSearch_:function(){this.functions_.isConstrained.call(this)?(this.state_.allItems=[],this.state_.matches=[],this.state_.partial=[],this.state_.collection.forEach(this.iterators_.calculateRelevance_.bind(this))):(this.state_.allItems=Array.from(this.state_.collection.keys()).map(this.iterators_.emptyMatch_),this.state_.matches=this.state_.allItems,this.state_.partial=[]),this.state_.searched=!0},updateMatches_:function(){this.state_.complete||(this.state_.searched||this.functions_.performSearch_.call(this),this.functions_.performSort_.call(this,this.state_.matches),this.state_.totalMatches=this.state_.matches.length,this.state_.index=0,this.state_.lastIndex=this.state_.totalMatches-1,this.state_.complete=!0)},performSort_:function(t){this.settings_.sort&&this.functions_.isConstrained.call(this)&&t.length&&t.sort(this.iterators_.sortComparator_),null!==this.settings_.customSort&&t.sort(this.settings_.customSort.bind(null,this.functions_.getItem_.bind(this)))},getItem_:function(t){return this.state_.collection.get(t[0])},getItemInject_:function(t){var e=this.state_.collection.get(t[0]);return Array.isArray(e)?e.push({relevance:t[1],missing:t[2]}):"object"===(void 0===e?"undefined":_typeof(e))&&(e[this.settings_.inject.property]={relevance:t[1],missing:t[2]}),e},toOriginalFormat_:function(t){return"array"===this.settings_.collectionType?this.settings_.inject.enabled?t.map(this.functions_.getItemInject_,this):t.map(this.functions_.getItem_,this):this.settings_.inject.enabled?t.reduce(this.iterators_.reduceInject_.bind(this),{}):t.reduce(this.iterators_.reduce_.bind(this),{})},updateConstraints_:function(){this.state_.ready||(""===this.state_.searchText?this.state_.searchTerms=[]:this.state_.searchTerms=(this.settings_.case?this.state_.searchText:this.state_.searchText.toLowerCase()).split(" "),this.state_.threshold=this.settings_.baseThreshold+this.state_.filters.length+(this.state_.searchTerms.length>0),this.state_.ready=!0)},isConstrained:function(){return this.functions_.updateConstraints_.call(this),this.state_.searchTerms.length||this.state_.filters.length}}),_defineProperty(_SearchLight$prototyp,"iterators_",{collection_:function(t,e){return[e,t[e]]},next_:function(){return this.state_.index>this.state_.lastIndex?{done:!0}:{done:!1,value:this.functions_.getItem_(this.state_.matches[this.state_.index++])}},nextInject_:function(){return this.state_.index>this.state_.lastIndex?{done:!0}:{done:!1,value:this.functions_.getItemInject_(this.state_.matches[this.state_.index++])}},property_:function(t,e){return t[e]||null},search_:function(t,e,s){var i=e.split(s).length-1;i?t[1]+=i:t[2]+=" "+s},filter_:function(t,e,s){var i=s[0],r=s[1],n=s[2];if("string"!=typeof t)switch(r){case"==":e[1]+=t[i]==n;break;case"===":e[1]+=t[i]===n;break;case"!=":e[1]+=t[i]!=n;break;case"!==":e[1]+=t[i]!==n;break;case">":e[1]+=t[i]>n;break;case">=":e[1]+=t[i]>=n;break;case"<":e[1]+=t[i]<n;break;case"<=":e[1]+=t[i]<=n;break;default:console.warn("Invalid filter operator:",r)}},calculateRelevance_:function(t,e){var s=[e,0,""],i="";this.state_.filters.forEach(this.iterators_.filter_.bind(this,t,s)),i="string"==typeof t?t:this.state_.keys.length?this.state_.keys.map(this.iterators_.property_.bind(this,t)).join("|"):Array.isArray(t)?t.join("|"):Object.keys(t).reduce(this.iterators_.reduceProperties_.bind(this,t),""),this.settings_.case||(i=i.toLowerCase()),this.state_.searchTerms.forEach(this.iterators_.search_.bind(this,s,i)),this.state_.allItems.push(s),0===s[1]||(s[1]<this.state_.threshold?this.state_.partial.push(s):this.state_.matches.push(s))},emptyMatch_:function(t){return[t,0,""]},reduce_:function(t,e){return t[e[0]]=this.functions_.getItem_.call(this,e),t},reduceInject_:function(t,e){return t[e[0]]=this.functions_.getItemInject_.call(this,e),t},reduceProperties_:function(t,e,s){return e+="|"+t[s]},sortComparator_:function(t,e){return e[1]>t[1]?1:e[1]===t[1]?e[0]<t[0]:-1}}),_SearchLight$prototyp),exports.default=SearchLight.prototype.search,"undefined"!=typeof window&&(window.SearchLight={search:SearchLight.prototype.search});